<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BravoDrive - Your Ride, Your Way</title>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            width: 100%;
        }

        :root {
            --primary: #1a1a2e;
            --primary-accent: #16213e;
            --secondary: #0f3460;
            --accent: #e94560;
            --accent-light: #f39c12;
            --success: #00d084;
            --warning: #ffa502;
            --danger: #e74c3c;
            --bg: #0a0e27;
            --surface: #16213e;
            --surface-light: #1f2d4d;
            --text: #ffffff;
            --text-muted: #9ca3af;
            --border: #2d3f5f;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .app-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ===== AUTH SECTION ===== */
        .auth-screen {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--bg) 0%, var(--primary) 50%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .auth-screen::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(229, 69, 96, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .auth-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 50px 40px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: 10;
            backdrop-filter: blur(10px);
            max-height: 90vh;
            overflow-y: auto;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            display: block;
        }

        .app-name {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .app-tagline {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .auth-mode-toggle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 30px;
        }

        .mode-btn {
            padding: 12px;
            background: var(--surface-light);
            border: 2px solid var(--border);
            color: var(--text-muted);
            border-radius: 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-align: center;
        }

        .mode-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            border-color: var(--accent);
            color: white;
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
        }

        .auth-mode-container {
            display: none;
        }

        .auth-mode-container.active {
            display: block;
        }

        .role-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .role-btn {
            padding: 12px;
            background: var(--surface-light);
            border: 2px solid var(--border);
            color: var(--text-muted);
            border-radius: 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-align: center;
        }

        .role-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .role-btn.active {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            border-color: var(--accent);
            color: white;
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            font-size: 13px;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .form-group input::placeholder {
            color: var(--text-muted);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--surface-light);
            box-shadow: 0 0 0 4px rgba(233, 69, 96, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(233, 69, 96, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .driver-fields {
            display: none;
            padding: 20px;
            background: var(--surface-light);
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .driver-fields.active {
            display: block;
        }

        .error-message {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid var(--danger);
            color: #ff6b6b;
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 12px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            background: rgba(0, 208, 132, 0.1);
            border: 1px solid var(--success);
            color: #00d084;
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 12px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ===== VERIFICATION SECTION ===== */
        .verification-screen {
            display: none;
        }

        .verification-screen.active {
            display: block;
        }

        .verification-code-input {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .code-digit {
            width: 100%;
            padding: 16px;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 12px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--text);
            transition: all 0.3s;
        }

        .code-digit:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(233, 69, 96, 0.1);
        }

        .action-btn {
            padding: 8px 16px;
            margin: 0 4px;
            border: none;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .action-btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
        }

        .action-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(233, 69, 96, 0.3);
        }

        /* ===== DASHBOARD ===== */
        .dashboard {
            display: flex;
            height: 100%;
            flex-direction: column;
            display: none;
        }

        .dashboard.active {
            display: flex;
        }

        .top-nav {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-mini {
            font-size: 28px;
            width: 40px;
            height: 40px;
        }

        .brand-info h2 {
            font-size: 14px;
            font-weight: 800;
            margin: 0;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-info p {
            font-size: 11px;
            color: var(--text-muted);
            margin: 2px 0 0 0;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            color: var(--text);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .notification-btn:hover {
            transform: scale(1.1);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: var(--surface-light);
            border-radius: 12px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .user-details p {
            margin: 0;
            font-size: 12px;
            line-height: 1.2;
        }

        .user-details .name {
            font-weight: 700;
            color: var(--text);
        }

        .user-details .role {
            color: var(--accent);
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
        }

        .main-wrapper {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 200px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 20px 0;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover {
            background: var(--surface-light);
            color: var(--accent);
            border-left-color: var(--accent);
        }

        .nav-item.active {
            background: rgba(233, 69, 96, 0.1);
            color: var(--accent);
            border-left-color: var(--accent);
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .page-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--text) 0%, var(--text-muted) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(233, 69, 96, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--accent);
        }

        .section-title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--text);
        }

        .table-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--surface-light);
            border-bottom: 1px solid var(--border);
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 700;
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
        }

        tbody tr:hover {
            background: var(--surface-light);
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(0, 208, 132, 0.15);
            color: var(--success);
        }

        .badge-pending {
            background: rgba(255, 165, 2, 0.15);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(231, 76, 60, 0.15);
            color: var(--danger);
        }

        .badge-primary {
            background: rgba(233, 69, 96, 0.15);
            color: var(--accent);
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 10px;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: 12px;
            background: var(--surface);
            color: var(--text);
            font-weight: 600;
            font-size: 13px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            animation: slideUp 0.3s ease-out;
        }

        .toast.success {
            background: rgba(0, 208, 132, 0.1);
            border-color: var(--success);
            color: var(--success);
        }

        .toast.error {
            background: rgba(231, 76, 60, 0.1);
            border-color: var(--danger);
            color: var(--danger);
        }

        .toast.info {
            background: rgba(233, 69, 96, 0.1);
            border-color: var(--accent);
            color: var(--accent);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stripe-element {
            padding: 14px 16px;
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            color: var(--text);
        }

        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .payment-modal.active {
            display: flex;
        }

        .payment-modal-content {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-title {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--text);
        }

        .modal-subtitle {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .btn-secondary {
            background: var(--surface-light);
            color: var(--text);
            border: 1px solid var(--border);
            flex: 1;
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .auth-card {
                padding: 30px 24px;
            }

            .role-selector {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .content {
                padding: 20px;
            }

            .page-title {
                font-size: 22px;
            }

            .verification-code-input {
                gap: 8px;
            }
        }
    </style>
    <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>

<body>
    <div class="app-container"><!-- AUTH SCREEN -->
        <div id="authScreen" class="auth-screen">
            <div class="auth-card">
                <div class="logo-section">
                    <svg class="logo-icon" viewbox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <lineargradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#e94560;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f39c12;stop-opacity:1" />
                            </lineargradient>
                            <filter id="glow">
                                <fegaussianblur stddeviation="2" result="coloredBlur" />
                                <femerge>
                                    <femergenode in="coloredBlur" />
                                    <femergenode in="SourceGraphic" />
                                </femerge>
                            </filter>
                        </defs>
                        <circle cx="60" cy="60" r="55" fill="none" stroke="url(#logoGrad)" stroke-width="2"
                            opacity="0.3" />
                        <path d="M 30 65 L 40 45 L 80 45 L 90 65 L 90 80 Q 90 85 85 85 L 35 85 Q 30 85 30 80 Z"
                            fill="url(#logoGrad)" filter="url(#glow)" />
                        <rect x="45" y="40" width="30" height="12" rx="2" fill="url(#logoGrad)" opacity="0.8" />
                        <rect x="38" y="50" width="12" height="10" rx="1" fill="#ffffff" opacity="0.2" />
                        <rect x="70" y="50" width="12" height="10" rx="1" fill="#ffffff" opacity="0.2" />
                        <circle cx="40" cy="85" r="8" fill="#ffffff" opacity="0.3" />
                        <circle cx="40" cy="85" r="5" fill="url(#logoGrad)" />
                        <circle cx="80" cy="85" r="8" fill="#ffffff" opacity="0.3" />
                        <circle cx="80" cy="85" r="5" fill="url(#logoGrad)" />
                        <circle cx="32" cy="68" r="2" fill="#ffd700" />
                        <circle cx="88" cy="68" r="2" fill="#ff6b00" />
                        <path d="M 10 60 Q 15 58 20 60" stroke="url(#logoGrad)" stroke-width="1.5" fill="none"
                            opacity="0.5" stroke-linecap="round" />
                        <path d="M 8 70 Q 13 68 18 70" stroke="url(#logoGrad)" stroke-width="1.5" fill="none"
                            opacity="0.3" stroke-linecap="round" />
                    </svg>
                    <div class="app-name">
                        BravoDrive
                    </div>
                    <div class="app-tagline">
                        Eswatini's Premier Ride Service
                    </div>
                </div>
                <div id="authMessage" class="error-message"></div>
                <div id="successMessage" class="success-message"></div><!-- Auth Mode Toggle -->
                <div class="auth-mode-toggle"><button class="mode-btn active" onclick="switchAuthMode('signup')"
                        id="signupModeBtn">Create Account</button> <button class="mode-btn"
                        onclick="switchAuthMode('signin')" id="signinModeBtn">Sign In</button>
                </div><!-- SIGN UP FORM -->
                <div id="signupContainer" class="auth-mode-container active">
                    <div class="role-selector"><button class="role-btn active" onclick="selectRole('passenger')"
                            data-role="passenger"> üë§ Passenger </button> <button class="role-btn"
                            onclick="selectRole('driver')" data-role="driver"> üöó Driver </button> <button
                            class="role-btn" onclick="selectRole('admin')" data-role="admin"> üë®‚Äçüíº Admin </button>
                    </div>
                    <form id="signupForm" onsubmit="handleSignUp(event)">
                        <div class="form-group"><label>Full Name</label> <input type="text" id="signupFullName"
                                placeholder="John Dlamini" required>
                        </div>
                        <div class="form-group"><label>Email</label> <input type="email" id="signupEmail"
                                placeholder="you@example.com" required>
                        </div>
                        <div class="form-group"><label>Phone</label> <input type="tel" id="signupPhone"
                                placeholder="+268 76 000 000" required>
                        </div>
                        <div class="form-group"><label>Password</label> <input type="password" id="signupPassword"
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                        </div>
                        <div class="form-group"><label>Confirm Password</label> <input type="password"
                                id="signupConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                        </div>
                        <div id="driverFieldsContainer" class="driver-fields">
                            <div class="form-group"><label>Vehicle Type</label> <select id="vehicleType">
                                    <option>Sedan</option>
                                    <option>SUV</option>
                                    <option>Van</option>
                                </select>
                            </div>
                            <div class="form-group"><label>License Plate</label> <input type="text" id="licensePlate"
                                    placeholder="SZ 1234 ABC">
                            </div>
                            <div class="form-group"><label>Driver License Number</label> <input type="text"
                                    id="driverLicense" placeholder="Enter your license number">
                            </div>
                        </div><button type="submit" class="btn btn-primary" id="signupBtn"> <span
                                id="signupBtnText">Create Account</span> </button>
                    </form>
                </div><!-- SIGN IN FORM -->
                <div id="signinContainer" class="auth-mode-container">
                    <form id="signinForm" onsubmit="handleSignIn(event)">
                        <div class="form-group"><label>Email</label> <input type="email" id="signinEmail"
                                placeholder="you@example.com" required>
                        </div>
                        <div class="form-group"><label>Password</label> <input type="password" id="signinPassword"
                                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        </div><button type="submit" class="btn btn-primary" id="signinBtn"> <span
                                id="signinBtnText">Sign In</span> </button>
                    </form>
                    <div
                        style="margin-top: 20px; padding: 16px; background: var(--surface-light); border-radius: 12px; border: 1px solid var(--border);">
                        <div
                            style="font-size: 11px; color: var(--text-muted); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">
                            Demo Accounts
                        </div><button type="button" class="action-btn action-btn-primary"
                            onclick="quickLogin('passenger')" style="width: 100%; margin-bottom: 8px;">Demo:
                            Passenger</button> <button type="button" class="action-btn action-btn-primary"
                            onclick="quickLogin('driver')" style="width: 100%; margin-bottom: 8px;">Demo:
                            Driver</button> <button type="button" class="action-btn action-btn-primary"
                            onclick="quickLogin('admin')" style="width: 100%;">Demo: Admin</button>
                    </div>
                </div><!-- VERIFICATION SCREEN -->
                <div id="verificationScreen" class="auth-mode-container verification-screen">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">
                            üìß
                        </div>
                        <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">Verify Your Email</h3>
                        <p style="color: var(--text-muted); font-size: 13px;">We sent a code to <strong
                                id="verifyEmailDisplay"></strong></p>
                    </div>
                    <div class="form-group" style="margin-bottom: 30px;"><label>Verification Code</label>
                        <div class="verification-code-input" id="codeInput"></div>
                    </div><button class="btn btn-primary" onclick="verifyEmail()" id="verifyBtn"> <span
                            id="verifyBtnText">Verify Email</span> </button>
                    <div style="text-align: center; margin-top: 20px;">
                        <p style="color: var(--text-muted); font-size: 12px; margin-bottom: 10px;">Didn't receive code?
                        </p><button type="button" class="action-btn action-btn-primary" onclick="resendCode()"
                            style="width: 100%;">Resend Code</button>
                    </div>
                </div>
            </div>
        </div><!-- DASHBOARD -->
        <div id="dashboard" class="dashboard">
            <div class="top-nav">
                <div class="nav-left">
                    <svg class="logo-mini" viewbox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <lineargradient id="logoGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#e94560;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#f39c12;stop-opacity:1" />
                            </lineargradient>
                        </defs>
                        <path d="M 30 65 L 40 45 L 80 45 L 90 65 L 90 80 Q 90 85 85 85 L 35 85 Q 30 85 30 80 Z"
                            fill="url(#logoGrad2)" />
                        <rect x="45" y="40" width="30" height="12" rx="2" fill="url(#logoGrad2)" opacity="0.8" />
                        <circle cx="40" cy="85" r="5" fill="url(#logoGrad2)" />
                        <circle cx="80" cy="85" r="5" fill="url(#logoGrad2)" />
                    </svg>
                    <div class="brand-info">
                        <h2>BravoDrive</h2>
                        <p>Eswatini</p>
                    </div>
                </div>
                <div class="nav-right"><button class="notification-btn" onclick="toggleNotifications()"> üîî </button>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">
                            U
                        </div>
                        <div class="user-details">
                            <p class="name" id="userName">User</p>
                            <p class="role" id="userRole">Passenger</p>
                            <p style="font-size: 10px; color: var(--success); margin-top: 2px;">‚úì Verified</p>
                        </div>
                    </div><button class="logout-btn" onclick="handleLogout()">Logout</button>
                </div>
            </div>
            <div class="main-wrapper">
                <div class="sidebar" id="sidebar"></div>
                <div class="content" id="content"></div>
            </div>
        </div>
    </div><!-- PAYMENT MODAL -->
    <div id="paymentModal" class="payment-modal">
        <div class="payment-modal-content">
            <div class="modal-title">
                üí≥ Top Up Your Wallet
            </div>
            <div class="modal-subtitle">
                Add funds to your BravoDrive account
            </div>
            <div class="form-group"><label>Amount (E)</label> <input type="number" id="paymentAmount" placeholder="100"
                    min="10" max="5000" value="100">
            </div>
            <div class="form-group"><label>Card Details</label>
                <div id="card-element" class="stripe-element"></div>
            </div>
            <div id="paymentError"
                style="display: none; background: rgba(231, 76, 60, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 12px; border-radius: 8px; font-size: 12px; margin-bottom: 16px;">
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary"
                    onclick="closePaymentModal()">Cancel</button> <button type="button" class="btn btn-primary"
                    style="flex: 1;" id="paymentBtn" onclick="processPayment()">Pay Now</button>
            </div>
        </div>
    </div>
    <script>
        // ‚ö†Ô∏è SECURITY: All sensitive keys are fetched from the backend
        // NO API keys, tokens, or secrets are exposed in the frontend code

        const API_URL = 'https://bravodrive-api.onrender.com'; // Update with your Render URL
        let stripe = null;
        let elements = null;
        let cardElement = null;
        let currentUser = null;
        let selectedRole = 'passenger';
        let currentPage = 'dashboard';
        let allUsers = [];
        let verificationCode = '';
        let pendingUser = null;

        // Initialize Stripe with key fetched from backend
        async function initializeStripe() {
            try {
                const response = await fetch(`${API_URL}/api/config/stripe-key`);
                const data = await response.json();

                if (!data.stripePublicKey) {
                    console.error('Failed to load Stripe public key from backend');
                    return;
                }

                stripe = Stripe(data.stripePublicKey);
                elements = stripe.elements();
                cardElement = elements.create('card', {
                    style: {
                        base: {
                            color: '#ffffff',
                            fontFamily: 'Poppins, sans-serif',
                            fontSize: '14px',
                            '::placeholder': { color: '#9ca3af' }
                        }
                    }
                });
                cardElement.mount('#card-element');
                cardElement.on('change', (e) => {
                    const errorElement = document.getElementById('paymentError');
                    if (e.error) {
                        errorElement.textContent = e.error.message;
                        errorElement.style.display = 'block';
                    } else {
                        errorElement.style.display = 'none';
                    }
                });
            } catch (error) {
                console.error('Stripe initialization error:', error);
            }
        }

        // Initialize SDKs
        async function initializeSDKs() {
            try {
                await window.elementSdk.init({
                    defaultConfig: { app_title: 'BravoDrive', app_tagline: 'Eswatini' },
                    onConfigChange: async (config) => { },
                    mapToCapabilities: (config) => ({
                        recolorables: [],
                        borderables: [],
                        fontEditable: undefined,
                        fontSizeable: undefined
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ['app_title', config.app_title],
                        ['app_tagline', config.app_tagline]
                    ])
                });
            } catch (e) {
                console.log('Element SDK ready');
            }
        }

        initializeSDKs();
        initializeStripe();

        // API Helper
        async function apiCall(endpoint, method = 'GET', data = null, token = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };

                if (token) {
                    options.headers['Authorization'] = `Bearer ${token}`;
                }

                if (data) options.body = JSON.stringify(data);

                const response = await fetch(`${API_URL}${endpoint}`, options);
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'API Error');
                }

                return result;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Load all users on startup
        async function loadAllUsers() {
            try {
                const result = await apiCall('/api/admin/users');
                if (result.success) {
                    allUsers = result.users;
                    console.log('Users loaded from backend:', allUsers.length);
                }
            } catch (error) {
                console.log('Could not load users:', error.message);
            }
        }

        loadAllUsers();

        // Switch auth mode
        function switchAuthMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.auth-mode-container').forEach(el => el.classList.remove('active'));
            clearMessages();

            if (mode === 'signup') {
                document.getElementById('signupModeBtn').classList.add('active');
                document.getElementById('signupContainer').classList.add('active');
            } else if (mode === 'signin') {
                document.getElementById('signinModeBtn').classList.add('active');
                document.getElementById('signinContainer').classList.add('active');
            } else if (mode === 'verification') {
                document.getElementById('verificationScreen').classList.add('active');
            }
        }

        // Role selection
        function selectRole(role) {
            selectedRole = role;
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-role="${role}"]`).classList.add('active');

            const driverFields = document.getElementById('driverFieldsContainer');
            driverFields.classList.toggle('active', role === 'driver');
        }

        // Generate verification code
        function generateVerificationCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        // Create verification input fields
        function createVerificationInputs() {
            const container = document.getElementById('codeInput');
            container.innerHTML = Array(6).fill(0).map((_, i) =>
                `<input type="text" class="code-digit" maxlength="1" inputmode="numeric" id="digit${i}" onkeyup="handleCodeInput(event, ${i})" onpaste="handlePaste(event)">`
            ).join('');
        }

        // Handle code input
        function handleCodeInput(event, index) {
            const value = event.target.value;

            if (!/^\d*$/.test(value)) {
                event.target.value = '';
                return;
            }

            if (value && index < 5) {
                document.getElementById(`digit${index + 1}`).focus();
            }

            if (!value && index > 0 && event.key === 'Backspace') {
                document.getElementById(`digit${index - 1}`).focus();
            }
        }

        // Handle paste
        function handlePaste(event) {
            event.preventDefault();
            const paste = (event.clipboardData || window.clipboardData).getData('text');
            const digits = paste.replace(/\D/g, '').slice(0, 6);

            digits.split('').forEach((digit, i) => {
                if (i < 6) document.getElementById(`digit${i}`).value = digit;
            });
        }

        // Get verification code
        function getVerificationCode() {
            return Array(6).fill(0).map((_, i) => document.getElementById(`digit${i}`).value).join('');
        }

        // Handle sign up
        async function handleSignUp(event) {
            event.preventDefault();

            const fullName = document.getElementById('signupFullName').value;
            const email = document.getElementById('signupEmail').value;
            const phone = document.getElementById('signupPhone').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }

            const signupBtn = document.getElementById('signupBtn');
            signupBtn.disabled = true;
            const btnText = document.getElementById('signupBtnText');
            const originalText = btnText.textContent;
            btnText.innerHTML = '<span class="loading-spinner"></span> Creating account...';

            try {
                const result = await apiCall('/api/auth/register', 'POST', {
                    email,
                    fullName,
                    phone,
                    password,
                    role: selectedRole,
                    vehicleType: selectedRole === 'driver' ? document.getElementById('vehicleType').value : null,
                    licensePlate: selectedRole === 'driver' ? document.getElementById('licensePlate').value : null,
                    driverLicense: selectedRole === 'driver' ? document.getElementById('driverLicense').value : null
                });

                verificationCode = result.verificationCode;
                console.log('‚úÖ Verification code:', verificationCode);

                pendingUser = {
                    email,
                    fullName,
                    phone,
                    password,
                    role: selectedRole
                };

                document.getElementById('verifyEmailDisplay').textContent = email;
                createVerificationInputs();
                document.getElementById('verificationScreen').classList.remove('active');
                document.getElementById('signupContainer').classList.remove('active');
                document.getElementById('verificationScreen').classList.add('active');

                showMessage(`‚úì Verification code sent to ${email}. Check console for code.`, 'success');
            } catch (error) {
                showMessage('‚ùå ' + error.message, 'error');
            } finally {
                signupBtn.disabled = false;
                btnText.textContent = originalText;
            }
        }

        // Verify email
        async function verifyEmail() {
            const enteredCode = getVerificationCode();

            if (enteredCode !== verificationCode) {
                showMessage('‚ùå Invalid verification code', 'error');
                return;
            }

            if (!pendingUser) {
                showMessage('Please sign up first', 'error');
                return;
            }

            const verifyBtn = document.getElementById('verifyBtn');
            verifyBtn.disabled = true;
            const btnText = document.getElementById('verifyBtnText');
            const originalText = btnText.textContent;
            btnText.innerHTML = '<span class="loading-spinner"></span> Verifying...';

            try {
                const result = await apiCall('/api/auth/verify-email', 'POST', {
                    email: pendingUser.email,
                    verificationCode: enteredCode
                });

                currentUser = pendingUser;
                currentUser.emailVerified = true;
                currentUser.balance = 0;
                currentUser.token = result.token;

                document.getElementById('signupForm').reset();
                clearMessages();

                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('userName').textContent = currentUser.fullName;
                document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
                document.getElementById('userAvatar').textContent = currentUser.fullName.charAt(0).toUpperCase();
                renderSidebar();
                showPage('dashboard');
                showToast(`‚ú® Welcome ${currentUser.fullName}!`, 'success');

                pendingUser = null;

                // Reload users
                await loadAllUsers();

            } catch (error) {
                showMessage('‚ùå ' + error.message, 'error');
            } finally {
                verifyBtn.disabled = false;
                btnText.textContent = originalText;
            }
        }

        // Resend code
        function resendCode() {
            if (pendingUser) {
                verificationCode = generateVerificationCode();
                console.log('New verification code:', verificationCode);
                showMessage('‚úì New code sent. Check console.', 'success');
                createVerificationInputs();
            }
        }

        // Handle sign in
        async function handleSignIn(event) {
            event.preventDefault();

            const email = document.getElementById('signinEmail').value;
            const password = document.getElementById('signinPassword').value;

            const signinBtn = document.getElementById('signinBtn');
            signinBtn.disabled = true;
            const btnText = document.getElementById('signinBtnText');
            const originalText = btnText.textContent;
            btnText.innerHTML = '<span class="loading-spinner"></span> Signing in...';

            try {
                const result = await apiCall('/api/auth/login', 'POST', {
                    email,
                    password
                });

                currentUser = result.user;
                currentUser.token = result.token;

                document.getElementById('signinForm').reset();
                clearMessages();

                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                document.getElementById('userName').textContent = currentUser.fullName;
                document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
                document.getElementById('userAvatar').textContent = currentUser.fullName.charAt(0).toUpperCase();
                renderSidebar();
                showPage('dashboard');
                showToast(`üéâ Welcome back ${currentUser.fullName}!`, 'success');

                await loadAllUsers();

            } catch (error) {
                showMessage('‚ùå ' + error.message, 'error');
            } finally {
                signinBtn.disabled = false;
                btnText.textContent = originalText;
            }
        }

        // Quick login with demo account
        async function quickLogin(role) {
            const names = {
                passenger: 'Sarah Johnson',
                driver: 'John Smith',
                admin: 'Admin User'
            };

            const demoUser = {
                email: `${role}@demo.com`,
                fullName: names[role],
                phone: '+268 76 000 000',
                password: 'demo123',
                role: role,
                vehicleType: role === 'driver' ? 'Sedan' : null,
                licensePlate: role === 'driver' ? 'SZ 001 BRA' : null,
                driverLicense: role === 'driver' ? 'DL123456' : null,
                totalEarnings: role === 'driver' ? 12500 : 0,
                balance: role === 'driver' ? 7940 : (role === 'passenger' ? 1250 : 0),
                paymentMethod: role === 'driver' || role === 'passenger' ? 'MTN Mobile Money' : null,
                rating: 4.8,
                emailVerified: true,
                verificationCode: '',
                createdAt: new Date().toISOString()
            };

            currentUser = demoUser;
            clearMessages();

            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userRole').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            document.getElementById('userAvatar').textContent = currentUser.fullName.charAt(0).toUpperCase();
            renderSidebar();
            showPage('dashboard');
            showToast(`üéâ Demo login: ${names[role]}!`, 'success');
        }

        // Render sidebar
        function renderSidebar() {
            const sidebar = document.getElementById('sidebar');
            let items = [];

            if (currentUser.role === 'passenger') {
                items = [
                    { id: 'dashboard', label: 'üìä Dashboard' },
                    { id: 'request-ride', label: 'üöó Request Ride' },
                    { id: 'active-rides', label: 'üó∫Ô∏è Active Rides' },
                    { id: 'history', label: 'üìã History' },
                    { id: 'payment', label: 'üí≥ Payments' }
                ];
            } else if (currentUser.role === 'driver') {
                items = [
                    { id: 'dashboard', label: 'üìä Dashboard' },
                    { id: 'available-rides', label: 'üöó Find Rides' },
                    { id: 'active-rides', label: 'üó∫Ô∏è Active' },
                    { id: 'earnings', label: 'üí∞ Earnings' },
                    { id: 'payment-settings', label: 'üí≥ Payments' },
                    { id: 'ratings', label: '‚≠ê Ratings' }
                ];
            } else if (currentUser.role === 'admin') {
                items = [
                    { id: 'dashboard', label: 'üìä Dashboard' },
                    { id: 'all-rides', label: 'üöó All Rides' },
                    { id: 'users', label: 'üë• Users' },
                    { id: 'revenue', label: 'üí∞ Revenue' },
                    { id: 'commissions', label: 'üìà Commissions' },
                    { id: 'support', label: 'üí¨ Support' }
                ];
            }

            sidebar.innerHTML = items.map(item =>
                `<div class="nav-item ${item.id === currentPage ? 'active' : ''}" onclick="showPage('${item.id}')">${item.label}</div>`
            ).join('');
        }

        // Show page
        function showPage(pageId) {
            currentPage = pageId;
            renderSidebar();
            const content = document.getElementById('content');

            if (currentUser.role === 'passenger') {
                renderPassengerPage(pageId, content);
            } else if (currentUser.role === 'driver') {
                renderDriverPage(pageId, content);
            } else if (currentUser.role === 'admin') {
                renderAdminPage(pageId, content);
            }
        }

        // PASSENGER PAGES
        function renderPassengerPage(pageId, content) {
            if (pageId === 'dashboard') {
                content.innerHTML = `
          <h1 class="page-title">Welcome, ${currentUser.fullName}!</h1>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üöó</div>
              <div class="stat-label">Total Rides</div>
              <div class="stat-value">24</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚≠ê</div>
              <div class="stat-label">Your Rating</div>
              <div class="stat-value">4.8</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-label">Total Spent</div>
              <div class="stat-value">E4,800</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üéÅ</div>
              <div class="stat-label">Promo Credit</div>
              <div class="stat-value">E150</div>
            </div>
          </div>
        `;
            } else if (pageId === 'request-ride') {
                content.innerHTML = `
          <h1 class="page-title">Request a Ride</h1>
          <div class="card">
            <div class="card-title">Find Your Ride</div>
            <div class="form-group">
              <label>Pickup Location</label>
              <input type="text" placeholder="Mbabane City, Manzini...">
            </div>
            <div class="form-group">
              <label>Dropoff Location</label>
              <input type="text" placeholder="Where to?">
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label>Passengers</label>
                <select><option>1</option><option>2</option><option>4</option></select>
              </div>
              <div class="form-group">
                <label>Ride Type</label>
                <select>
                  <option>üöó Economy (E125)</option>
                  <option>üöô Comfort (E187)</option>
                  <option>üèéÔ∏è Premium (E290)</option>
                </select>
              </div>
            </div>
            <button class="btn btn-primary" style="width: 100%;">Search Rides</button>
          </div>
        `;
            } else if (pageId === 'payment') {
                content.innerHTML = `
          <h1 class="page-title">Payment Methods</h1>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üí≥</div>
              <div class="stat-label">Wallet Balance</div>
              <div class="stat-value">E${currentUser.balance}</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-label">Spent This Month</div>
              <div class="stat-value">E945</div>
            </div>
          </div>
          <div class="card">
            <div class="card-title">Your Payments</div>
            ${currentUser.paymentMethod ? `
              <div style="padding: 16px; background: var(--surface-light); border-radius: 12px; margin-bottom: 16px; border: 1px solid var(--border);">
                <div style="font-weight: 600; margin-bottom: 8px;">üí≥ ${currentUser.paymentMethod}</div>
              </div>
            ` : `
              <div style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üí≥</div>
                <div style="color: var(--text-muted); margin-bottom: 20px;">No payment method added</div>
              </div>
            `}
            <button class="btn btn-primary" onclick="openPaymentModal()">Top Up Wallet</button>
          </div>
        `;
            } else if (pageId === 'history') {
                content.innerHTML = `
          <h1 class="page-title">Ride History</h1>
          <div class="table-container">
            <table>
              <thead><tr><th>Date</th><th>From</th><th>To</th><th>Amount</th><th>Driver</th><th>Rating</th></tr></thead>
              <tbody>
                <tr>
                  <td>Dec 10</td>
                  <td>Mbabane</td>
                  <td>Manzini</td>
                  <td>E185</td>
                  <td>John Smith</td>
                  <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                </tr>
              </tbody>
            </table>
          </div>
        `;
            }
        }

        // DRIVER PAGES
        function renderDriverPage(pageId, content) {
            if (pageId === 'dashboard') {
                content.innerHTML = `
          <h1 class="page-title">Driver Dashboard</h1>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üöó</div>
              <div class="stat-label">Rides Today</div>
              <div class="stat-value">12</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-label">Today Earnings</div>
              <div class="stat-value">E2,240</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚≠ê</div>
              <div class="stat-label">Your Rating</div>
              <div class="stat-value">4.9</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üí∏</div>
              <div class="stat-label">Available Balance</div>
              <div class="stat-value">E${currentUser.balance}</div>
            </div>
          </div>
        `;
            } else if (pageId === 'available-rides') {
                content.innerHTML = `
          <h1 class="page-title">Available Rides</h1>
          <div class="table-container">
            <table>
              <thead><tr><th>Passenger</th><th>From</th><th>To</th><th>Estimate</th><th>Your Earnings</th><th>Action</th></tr></thead>
              <tbody>
                <tr>
                  <td>Sarah Johnson</td>
                  <td>Mbabane</td>
                  <td>Manzini</td>
                  <td>E185</td>
                  <td style="color: var(--success); font-weight: 700;">E170</td>
                  <td><button class="action-btn action-btn-primary">Accept</button></td>
                </tr>
              </tbody>
            </table>
          </div>
        `;
            } else if (pageId === 'earnings') {
                content.innerHTML = `
          <h1 class="page-title">Earnings & Payouts</h1>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-label">Total Earnings</div>
              <div class="stat-value">E${currentUser.totalEarnings}</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚è≥</div>
              <div class="stat-label">Pending</div>
              <div class="stat-value">E4,560</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚úÖ</div>
              <div class="stat-label">Available Balance</div>
              <div class="stat-value">E${currentUser.balance}</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-label">Completed Rides</div>
              <div class="stat-value">245</div>
            </div>
          </div>
        `;
            } else if (pageId === 'payment-settings') {
                content.innerHTML = `
          <h1 class="page-title">Payment Settings</h1>
          <div class="card">
            <div class="card-title">Payment Method</div>
            ${currentUser.paymentMethod ? `
              <div style="padding: 20px; background: var(--surface-light); border-radius: 12px; border: 1px solid var(--border);">
                <div style="margin-bottom: 16px;">
                  <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">PAYMENT TYPE</div>
                  <div style="font-weight: 700; margin-bottom: 16px;">${currentUser.paymentMethod}</div>
                </div>
              </div>
            ` : `
              <div style="text-align: center; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üí≥</div>
                <div style="color: var(--text-muted); margin-bottom: 20px;">No payment method added</div>
              </div>
            `}
          </div>
        `;
            } else if (pageId === 'ratings') {
                content.innerHTML = `
          <h1 class="page-title">Your Ratings</h1>
          <div class="card">
            <div class="card-title">Rating: ‚≠ê ${currentUser.rating} / 5.0</div>
            <div style="display: grid; gap: 12px; margin-top: 20px;">
              <div style="padding: 16px; background: var(--surface-light); border-radius: 12px; border: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <div style="font-weight: 600;">Sarah Johnson</div>
                  <div>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
                <div style="font-size: 12px; color: var(--text-muted);">Professional and friendly driver!</div>
              </div>
            </div>
          </div>
        `;
            }
        }

        // ADMIN PAGES
        function renderAdminPage(pageId, content) {
            if (pageId === 'dashboard') {
                content.innerHTML = `
          <h1 class="page-title">Admin Dashboard</h1>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üë•</div>
              <div class="stat-label">Total Users</div>
              <div class="stat-value">${allUsers.length}</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üöó</div>
              <div class="stat-label">Total Rides</div>
              <div class="stat-value">5,678</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-label">Platform Revenue</div>
              <div class="stat-value">E452,300</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">‚≠ê</div>
              <div class="stat-label">Avg Rating</div>
              <div class="stat-value">4.7</div>
            </div>
          </div>
        `;
            } else if (pageId === 'users') {
                const usersHtml = allUsers.length > 0 ? `
          <div class="table-container">
            <table>
              <thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Verified</th><th>Joined</th></tr></thead>
              <tbody>
                ${allUsers.map(u => `
                  <tr>
                    <td>${u.full_name}</td>
                    <td>${u.email}</td>
                    <td><span class="badge badge-primary">${u.role}</span></td>
                    <td>${u.email_verified ? '<span class="badge badge-success">‚úì Yes</span>' : '<span class="badge badge-danger">‚úó No</span>'}</td>
                    <td>${new Date(u.created_at).toLocaleDateString()}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        ` : `
          <div class="empty-state">
            <div class="empty-icon">üë•</div>
            <div class="empty-title">No Users Yet</div>
          </div>
        `;

                content.innerHTML = `
          <h1 class="page-title">User Management</h1>
          ${usersHtml}
        `;
            } else if (pageId === 'all-rides') {
                content.innerHTML = `
          <h1 class="page-title">All Rides</h1>
          <div class="table-container">
            <table>
              <thead><tr><th>Ride ID</th><th>Passenger</th><th>Driver</th><th>Amount</th><th>Commission</th><th>Date</th><th>Status</th></tr></thead>
              <tbody>
                <tr>
                  <td>#RD001</td>
                  <td>Sarah Johnson</td>
                  <td>John Smith</td>
                  <td>E185</td>
                  <td style="color: var(--success);">E14.80</td>
                  <td>Dec 10</td>
                  <td><span class="badge badge-success">Completed</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        `;
            } else if (pageId === 'revenue') {
                content.innerHTML = `
          <h1 class="page-title">Revenue Analytics</h1>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-label">Total Revenue</div>
              <div class="stat-value">E452,300</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-label">This Month</div>
              <div class="stat-value">E124,500</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">üìà</div>
              <div class="stat-label">Avg Per Ride</div>
              <div class="stat-value">E79.50</div>
            </div>
          </div>
        `;
            } else if (pageId === 'commissions') {
                content.innerHTML = `
          <h1 class="page-title">Commission Management</h1>
          <div class="card">
            <div class="card-title">Commission Structure: 8% Admin | 92% Driver</div>
            <div class="table-container" style="margin-top: 20px;">
              <table>
                <thead><tr><th>Driver</th><th>Rides</th><th>Revenue</th><th>Admin Fee</th><th>Driver Payout</th></tr></thead>
                <tbody>
                  <tr>
                    <td>John Smith</td>
                    <td>145</td>
                    <td>E14,505</td>
                    <td style="color: var(--success);">E1,160</td>
                    <td>E13,345</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        `;
            } else if (pageId === 'support') {
                content.innerHTML = `
          <h1 class="page-title">Support Tickets</h1>
          <div class="table-container">
            <table>
              <thead><tr><th>Ticket ID</th><th>User</th><th>Subject</th><th>Priority</th><th>Status</th></tr></thead>
              <tbody>
                <tr>
                  <td>#TK001</td>
                  <td>John Smith</td>
                  <td>Payment issue</td>
                  <td><span class="badge badge-danger">High</span></td>
                  <td><span class="badge badge-pending">Open</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        `;
            }
        }

        // Payment modal functions
        function openPaymentModal() {
            document.getElementById('paymentModal').classList.add('active');
            if (cardElement) cardElement.focus();
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
            document.getElementById('paymentAmount').value = '100';
            document.getElementById('paymentError').style.display = 'none';
            if (cardElement) cardElement.clear();
        }

        async function processPayment() {
            const amount = parseInt(document.getElementById('paymentAmount').value);
            const paymentBtn = document.getElementById('paymentBtn');

            if (!amount || amount < 10) {
                document.getElementById('paymentError').textContent = 'Amount must be at least E10';
                document.getElementById('paymentError').style.display = 'block';
                return;
            }

            paymentBtn.disabled = true;
            paymentBtn.innerHTML = '<span class="loading-spinner"></span> Processing...';

            try {
                // Create payment intent on backend
                const result = await apiCall('/api/payments/create-intent', 'POST', {
                    amount: amount * 100,
                    currency: 'szl',
                    userEmail: currentUser.email,
                    userId: currentUser.email
                }, currentUser.token);

                if (!result.clientSecret) {
                    throw new Error('Failed to create payment intent');
                }

                // Confirm payment with Stripe
                const { paymentIntent, error } = await stripe.confirmCardPayment(result.clientSecret, {
                    payment_method: {
                        card: cardElement,
                        billing_details: {
                            name: currentUser.fullName,
                            email: currentUser.email
                        }
                    }
                });

                if (error) {
                    document.getElementById('paymentError').textContent = error.message;
                    document.getElementById('paymentError').style.display = 'block';
                } else if (paymentIntent.status === 'succeeded') {
                    currentUser.balance += amount;
                    showToast(`‚úÖ Successfully added E${amount} to wallet!`, 'success');
                    closePaymentModal();
                    showPage('payment');
                }
            } catch (error) {
                document.getElementById('paymentError').textContent = error.message;
                document.getElementById('paymentError').style.display = 'block';
            } finally {
                paymentBtn.disabled = false;
                paymentBtn.innerHTML = 'Pay Now';
            }
        }

        // Logout
        function handleLogout() {
            currentUser = null;
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('signupForm').reset();
            document.getElementById('signinForm').reset();
            switchAuthMode('signup');
            showToast('Logged out successfully', 'success');
        }

        // Messages
        function showMessage(message, type) {
            clearMessages();
            const container = type === 'error'
                ? document.getElementById('authMessage')
                : document.getElementById('successMessage');
            container.textContent = message;
            container.classList.add('show');
        }

        function clearMessages() {
            document.getElementById('authMessage').classList.remove('show');
            document.getElementById('successMessage').classList.remove('show');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function toggleNotifications() {
            console.log('Notifications');
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            console.log('‚úÖ BravoDrive with Secure Payments Ready');
            console.log('üîí All API keys are securely stored on the backend');
        });
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9cd31cb6d60ef23c',t:'MTc3MDk3Mjk4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>